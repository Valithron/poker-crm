<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BroTime CRM - Add Player</title>
    <link rel="stylesheet" href="styles.css?v=3" />
  </head>
  <body>
    <div id="navbar-placeholder"></div>
    <main
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        min-height: 100vh;
      "
    >
      <form
        id="playerForm"
        style="
          background-color: #eef3ec;
          padding: 2rem;
          border-radius: 8px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
          max-width: 400px;
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: 0.75rem;
        "
      >
        <h2 style="text-align: center; color: #004400;">Add a New Player</h2>
        <input type="text" id="name" placeholder="Full Name" required />
        <input type="email" id="email" placeholder="Email" />
        <input type="tel" id="phone" placeholder="Phone" />
        <input type="text" id="invitedBy" placeholder="Invited By" />
        <button type="submit">Add Player</button>
      </form>
    </main>

    <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDqLxlBmdM_O1wmeOPPKyRh8PFnSw-dTH0",
        authDomain: "poker-crm.firebaseapp.com",
        projectId: "poker-crm",
        storageBucket: "poker-crm.appspot.com",
        messagingSenderId: "218784808902",
        appId: "1:218784808902:web:c587bdf584d704f7733107",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const form = document.getElementById("playerForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const invitedBy = document.getElementById("invitedBy").value.trim();
        const role = "guest";

        if (!name) return alert("Full name is required.");

        const firstName = name.split(" ")[0];

        try {
          await addDoc(collection(db, "players"), {
            name,
            firstName,
            email,
            phone,
            invitedBy,
            role,
          });
          alert("Player added!");
          form.reset();
        } catch (error) {
          console.error("Error adding document: ", error);
          alert("Something went wrong.");
        }
      });
    </script>
    <script src="loadNav.js"></script>
    <script type="module">
      import { authCheck } from "./authGuard.js";
      authCheck();
    </script>
  </body>
</html>
